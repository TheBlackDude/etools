<!--
Global behavior definition
-->
<script>
 // jscs:disable
'use strict';
var commonBv = commonBv || {};


commonBv.interventions = {
    
    _getIntervention: function(interventionId) {
      return _.find(this.interventions, function(item) { 
        return item.id === Number(interventionId); 
      });
    },
    _getIndicator: function(interventionId, rcId){
      var intervention = this._getIntervention(interventionId);
      return _.find(intervention.results, function(item) { 
        return item.id === Number(rcId); 
      });
    },
    _getIndicators: function(interventionId){
        var result = this._processIndicatorsOutputs(this._getIntervention(interventionId));
        return result.indicators;
    },
    _getOutputIndicators: function(interventionId){
        var result = this._processIndicatorsOutputs(this._getIntervention(interventionId));
        return result.outputs;
    },
    _processIntervention: function(intervention){
        if (!intervention){
          return;
        }
        var result = this._processIndicatorsOutputs(intervention);
        this.indicators = result.indicators;
        this.outputs = result.outputs;
    },
    _processIndicatorsOutputs: function(intervention) {
        
        // need to get a dict of indicators filtered by output;
        var inds = [];
        var tempOutputs = {};

        intervention.results.forEach(function(el) {
          // el is the result_chain object
          // Make sure it's an indicator result
          if (!el.indicator){
            return;
          }
          inds.push(el);
          if (tempOutputs[el.result.id]){
            tempOutputs[el.result.id].indicators.push(el);
          } else {
            tempOutputs[el.result.id] = {};
            tempOutputs[el.result.id].output = el.result;
            tempOutputs[el.result.id].indicators = [el];
          }

        });
        var outputs = [];
        _.each(tempOutputs, function(value) {
            outputs.push(value);
        });
        return {
            indicators: inds,
            outputs: outputs
        };
        
    }
};
</script>