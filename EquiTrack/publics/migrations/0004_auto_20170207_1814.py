# -*- coding: utf-8 -*-
# Generated by Django 1.9.10 on 2017-02-07 16:14
from __future__ import unicode_literals

import logging

from django.db import migrations

log = logging.getLogger(__name__)


def populate_default_currency(apps, schema_editor):
    BusinessArea = apps.get_model('publics', 'BusinessArea')

    for business_area in BusinessArea.objects.all():
        countries = business_area.countries.all()
        if countries.count() != 1:
            log.error('Cannot assign default currency to business area %s - %s', business_area.id, business_area.name)
            continue

        default_currency = countries.first().currency
        business_area.default_currency = default_currency
        business_area.save()


class Migration(migrations.Migration):

    dependencies = [
        ('publics', '0003_businessarea_default_currency'),
    ]

    operations = [
        migrations.RunPython(populate_default_currency),
    ]
